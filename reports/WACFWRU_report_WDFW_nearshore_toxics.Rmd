---
title: A Retrospective Analysis of Mussel Monitoring for Nearshore Toxics in Puget
  Sound
author:
- name: Catherine Wangen
  email: cwangen@uw.edu
  institute: qerm
  correspondence: yes
- name: Mark D. Scheuerell
  email: scheuerl@uw.edu
  institute: wacfwru
  correspondence: yes
subtitle: \textit{Draft Report}
output:
  pdf_document:
    highlight: haddock
    fig_caption: yes
    number_sections: yes
    pandoc_args:
    - --lua-filter=scholarly-metadata.lua
    - --lua-filter=author-info-blocks.lua
  html_document:
    df_print: paged
institute:
- qerm: Quantitative Ecology and Resource Management, University of Washington, Seattle,
    WA
- wacfwru: U.S. Geological Survey Washington Cooperative Fish and Wildlife Research
    Unit, School of Aquatic and Fishery Sciences, University of Washington, Seattle,
    WA
documentclass: article
geometry: margin=1in
linestretch: 1.1
fontsize: 12pt
header-includes:
- \usepackage{lineno}
- \linenumbers
- \usepackage{float}
- \floatplacement{figure}{H}
bibliography: references.bib
csl: aslo.csl
urlcolor: blue
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warnings = FALSE)

## load {knitcitations}
# library("knitcitations")

## clean out any existing .bib files
# cleanbib()

## set pandoc for formatting
options("citation_format" = "pandoc")
```

```{r analysis setup, include = FALSE}
#### Load libraries ####

library(MASS)
library(tidyverse)
library(here)
library(lme4)
library(RLRsim)
library(ggdist)
library(tidyquant)
library(dplyr)
library(knitr)
library(broom.mixed)
library(sjPlot)
library(AICcmodavg)
library(simr)

# set directories
clean_data_dir <- here("data", "clean")
outputs <- here("outputs")

# get excel file name
totals <- "totals_all.csv"

# load dataframe
mussel_df <- read_csv(here(clean_data_dir, totals), show_col_types = FALSE)

#abs of dry value for now (note below)
mussel_df$dry_value <- abs(mussel_df$dry_value)

#order WRIAs and LIOS
mussel_df$lio_areas <- factor(mussel_df$lio_areas, levels = c("Penn Cove Baseline","South Sound", "Puyallup / White", "South Central", "West Sound", "Hood Canal",  "Snohomish / Stillaguamish", "Island", "Strait of Juan de Fuca", "Skagit / Samish", "San Juan", "Whatcom", "Penn Cove Reference"))

mussel_df$wria_nr <- factor(mussel_df$wria_nr,levels = rev(c("1", "2", "3","6", "5",
                                                         "18","19" ,
                                                         "17","15", 
                                                          "7", "8", "9","14","16",
                                                          "22","13","12","10", "11", 
                                                          "24", "Penn Cove Reference","Penn Cove Baseline")))

#as category
mussel_df$year <- as.factor(mussel_df$year)
mussel_df$wria_nr <- as.factor(mussel_df$wria_nr)
mussel_df$lio_areas <- as.factor(mussel_df$lio_areas)

# #remove Penn Cove reference samples
# #mussel_df <- mussel_df[!is.na(mussel_df$fund_source),]
# #Penn Cove Reference samples have had LIO and WRIA changed to "Penn Cove Reference"
# 
# 
# mussel_df <- subset(mussel_df, site_name != "Penn Cove Reference")
# 
# #remove samples from outside Puget sound
# mussel_df <- subset(mussel_df, longitude > -123.5)

#create analyte dataframes
PA_df <- mussel_df %>%
  filter(mussel_df$analyte == "SumPAHs16")
PA_df <- PA_df[complete.cases(PA_df),]
PB_df <- mussel_df %>%
  filter(mussel_df$analyte == "SumPBDEs11")
PB_df <- PB_df[complete.cases(PB_df),]
PC_df <- mussel_df %>%
  filter(mussel_df$analyte == "SumPCBs2x17")
PC_df <- PC_df[complete.cases(PC_df),]


#create analyte dataframes with low data LIOs removed
short_PC_df <-PC_df %>% filter(str_detect(lio_areas, 
                                          paste(c("Island","San Juan","Strait of Juan de Fuca"), 
                                                collapse = "|"), negate = TRUE))
short_PB_df <-PB_df %>% filter(str_detect(lio_areas, 
                                          paste(c("Island","San Juan","Strait of Juan de Fuca"), 
                                                collapse = "|"), negate = TRUE))
short_PA_df <-PA_df %>% filter(str_detect(lio_areas, 
                                          paste(c("Island","San Juan","Strait of Juan de Fuca"), 
                                                collapse = "|"), negate = TRUE))

```

\vspace{0.25in}

Version `r paste0("0.", format(Sys.time(), '%y.%m.%d'))`

# Background

This report provides a retrospective analysis of data generated by previous mussel monitoring surveys coordinated under Washington Department of Fish and Wildlife's (WDFW) Toxics Biological Obsevation System (TBiOS). We determine how existing contaminant data from historical bay mussels (*Mytilus trossulus*) can be used as a Toxics in the Nearshore Vital Sign indicator. In addition, we assess the predictive ability of existing sampling rate to predict expected contaminant trends. 


# Methods

All materials used to prepare this report can be found in the following GitHub repository: `https://github.com/cwangen/mussel_toxics`.

## Data

Uncontaminated mussels from a local aquaculture source were transplanted to various locations along the Puget Sound shoreline, covering a broad range of upland land-use types from rural to highly urban. Mussels were placed into cages and left to incubate for 49-107 days before they were recovered, and concentrations of several major contaminant classes were measured. Four mussels surveys were performed, with mussels being retrieved in 2013, 2016, 2018, and 2020. Our analysis focuses on polycyclic aromatic hydrocarbons (PAHs), polybrominated diphenyl ethers (PBDEs), and polychlorinated biphenyls(PCBs) due to their significance in both ecosystem and human health.

## Data Analysis

The data used in this analysis originated in the form of an Microsoft Excel file, titled `2013-20MusselCagesPOPsPAHs_Cnty_WRIA_LIO_Coverages.xlsx.` The data included more fields than used in our analysis, and can be found in its entirety in `/mussel_toxics/data/raw/`. The data file was cleaned in order to correct minor inconsistencies and errors, resulting in `/mussel_toxics/data/clean/totals_all.csv`. 

We used the dry weights of toxics found in each sample for analysis. Although the data records also included the concentration of lipids, as well as wet weight, dry weight is the standard for reporting toxicology data. Data summaries include the following

* Tables of dry weights organized by categorical variables;

* Maps of dry weight concentrations;

* Raincloud plots, consisting of a box plot, an approximate probability density, and the individual data points, for each toxin for based upon WRIA and year.

Samples from the original aquaculture source used as reference materials were removed from the analyses, but included in the concentration maps. Samples outside of Puget Sound (east of -123.5 longitude) were also removed from sampling, but remain in map figures. Figures \ref{fig:PAmap}, \ref{fig:PBmap}, and \ref{fig:PCmap} display the concentrations of PAHs, PBDEs, and PCBs over time in mussel samples, respectively. They also shed light on how sampling is inconsistent both spatially and temporally. 


```{r PAmap, fig.cap = "\\label{fig:PAmap}Estimated concentration of PAHs across Puget Sound.",out.width = "500px"}
# knitr::include_graphics(here("outputs","PAHmaps_short_legend.pdf"))
knitr::include_graphics(here("outputs","PAH_map.png"))
```

```{r PBmap, fig.cap = "\\label{fig:PBmap}Estimated concentration of PBDEs across Puget Sound.",out.width = "500px"}
# knitr::include_graphics(here("outputs","PBDEmaps.pdf"))
knitr::include_graphics(here("outputs","PBDE_map.png"))
```

```{r PCMap, fig.cap = "\\label{fig:PCmap}Estimated concentration of PCBs across Puget Sound.",out.width = "500px"}
# knitr::include_graphics(here(outputs,"PCBmaps.pdf"))
knitr::include_graphics(here(outputs,"PCB_map.png"))
```

```{r rain_PAH_year, , fig.cap = "\\label{fig:rain_PAH_year}Distribution of the log concentration of PAHs across years."}
PA_df %>% 
  ggplot(aes(x = year, y = dry_value)) +
  ggdist::stat_halfeye(adjust = .5, width = .3, .width = 0, justification = -.3, point_colour = NA) + 
    scale_y_continuous(trans='log10')+
  geom_boxplot(width = .1, outlier.shape = NA) + coord_flip()+ coord_flip()+
  ggdist::stat_dots(side = "left", dotsize = .1, justification = 1.1, binwidth = .1)+

  theme(axis.text.x=element_text(angle=270,hjust=1)) +
  xlab("Year") +
  ylab("log10(dry value)")+
  ggtitle("PAHs Across Years")
```

```{r rain_PAH_LIO, , fig.cap = "\\label{fig:rain_PAH_LIO}Distribution of the log concentration of PAHs across LIOs."}
PA_df %>% 
  ggplot(aes(x = lio_areas, y = dry_value)) +
  scale_y_continuous(trans='log10')+
  ggdist::stat_halfeye(adjust = .5, width = .3, .width = 0, justification = -.3, point_colour = NA) + 
  geom_boxplot(width = .1, outlier.shape = NA) + coord_flip()+
  ggdist::stat_dots(side = "left", dotsize = .1, justification = 1.1, binwidth = .1)+  theme(axis.text.x=element_text(angle=315,hjust = 0.01)) +
  xlab("LIO Area") +
  ylab("log10(dry value)")+
  ggtitle("PAHs Across LIOs")
```

```{r rain_PBDE_year, , fig.cap = "\\label{fig:rain_PBDE_year}Distribution of the log concentration of PBDEs across years."}
PB_df %>% 
  ggplot(aes(x = year, y = dry_value)) +
  scale_y_continuous(trans='log10')+
  ggdist::stat_halfeye(adjust = .5, width = .3, .width = 0, justification = -.3, point_colour = NA) + 
  geom_boxplot(width = .1, outlier.shape = NA) + coord_flip()+
  ggdist::stat_dots(side = "left", dotsize = .1, justification = 1.1, binwidth = .1)+
  theme(axis.text.x=element_text(angle=270,hjust=1)) +
  xlab("Year") +
  ylab("log10(dry value)")+
  ggtitle("PBDEs Across Years")
```

```{r rain_PBDE_LIO, , fig.cap = "\\label{fig:rain_PBDE_LIO}Distribution of the log concentration of PBDEs across LIOs."}
PB_df %>% 
  ggplot(aes(x = lio_areas, y = dry_value)) +
  scale_y_continuous(trans='log10')+
  ggdist::stat_halfeye(adjust = .5, width = .3, .width = 0, justification = -.3, point_colour = NA) + 
  geom_boxplot(width = .1, outlier.shape = NA) + coord_flip()+
  ggdist::stat_dots(side = "left", dotsize = .1, justification = 1.1, binwidth = .1)+
   theme(axis.text.x=element_text(angle=315,hjust = 0.01)) +
  xlab("LIO Area") +
  ylab("log10(dry value)")+
  ggtitle("PBDEs Across LIOs")
```

```{r rain_PCB_year, , fig.cap = "\\label{fig:rain_PCB_year}Distribution of the log concentration of PCBs across years."}
PC_df %>% 
  ggplot(aes(x = year, y = dry_value)) +
  scale_y_continuous(trans='log10')+
  ggdist::stat_halfeye(adjust = .5, width = .3, .width = 0, justification = -.3, point_colour = NA) + 
  geom_boxplot(width = .1, outlier.shape = NA) + coord_flip()+
  ggdist::stat_dots(side = "left", dotsize = .1, justification = 1.1, binwidth = .1) +
theme(axis.text.x=element_text(angle=270,hjust=1)) +
  xlab("Year") +
  ylab("log10(dry value)")+
ggtitle("PCBs Across Years")
```

```{r rain_PCB_LIO, , fig.cap = "\\label{fig:rain_PCB_LIO}Distribution of the log concentration of PCBs across LIOs."}
PC_df %>% 
  ggplot(aes(x = lio_areas, y = dry_value)) +
  scale_y_continuous(trans='log10')+
  ggdist::stat_halfeye(adjust = .5, width = .3, .width = 0, justification = -.3, point_colour = NA) + 
  geom_boxplot(width = .1, outlier.shape = NA) + coord_flip()+
  ggdist::stat_dots(side = "left", dotsize = .1, justification = 1.1, binwidth = .1)+
  theme(axis.text.x=element_text(angle=315,hjust = 0.01)) +
  xlab("LIO Area") +
  ylab("log10(dry value)")+
ggtitle("PCBs Across LIOs")
```


## Statistical modeling

We modeled the dry weight of the analytes found in mussels using a simple linear regression using soak time, impervious surface, and year as variables. This model has the form

$$
\operatorname{dry\_value} = \alpha + \beta_{1}(\operatorname{year}_{\operatorname{2016}}) + \beta_{2}(\operatorname{year}_{\operatorname{2018}}) + \beta_{3}(\operatorname{year}_{\operatorname{2020}}) + \beta_{4}(\operatorname{time}) + \beta_{5}(\operatorname{mean\_is\_au}) + \epsilon
$$

```{r}
PA_lm <- lm(dry_value ~ year + time + mean_is_au ,data = PA_df)

PB_lm <- lm(dry_value ~ year + time + mean_is_au ,data = PB_df)

PC_lm <- lm(dry_value ~ year + time + mean_is_au ,data = PC_df)
```

```{r}



```


## Power analyses

The power to detect differences among years is very high (95-100%), but importantly, this should not be confounded with the power to detect long-term changes over time $per$ $se$. That is, in this case the high power indicates that one could estimate the difference between any two years, whether or not they occurred sequentially in time.

### PAH

Here is the power calculation for `year`.

```{r power_PAH, cache = TRUE}
#### PAH ####

powerSim(PA_lm, nsim = 100, progress = FALSE)
```

### PBDE

Here is the power calculation for `year`.

```{r power_PBDE, cache = TRUE}
#### PBDEs ####
powerSim(PA_lm, nsim = 100, progress = FALSE)
```

### PCB

Here is the power calculation for `year`.

```{r power_PCB, cache = TRUE}
#### PCBs ####
powerSim(PC_lm, nsim = 100, progress = FALSE)
```


# Summary

Our modeling suggests that the mean percent of impervious surface explains a large proportion of the variance in PAHs, PBDEs, and PCBs. The interactive effects of year and LIO also appear important, suggesting shifts in the distributions of analyte concentrations over time. However, the best supported models have limited power to detect meaningful changes in analytes over time. We found that there is very high power to detect differences among any two years in the data set, but that it does not equate to an ability to detect long-term changes across years.


# Acknowledgments

We acknowledge the help and support from the environmental toxicology group at WDFW, including Jim West, Sandra O'Neill, Louisa Harding, and Mariko Langness.

\newpage

# Appendix


## Tukey's Test tables

```{r param_summary_tables3}

aA <- aov(dry_value ~ lio_areas, data = PA_df)

aB <- aov(dry_value ~ lio_areas, data = PB_df)

aC <- aov(dry_value ~ lio_areas, data = PC_df)

kable(tidy((TukeyHSD(aA, conf.level=.95))), digits = 2,
      caption = "Pairwise Tukey's test statistics by LIO for PAHs.")

kable(tidy((TukeyHSD(aB, conf.level=.95))), digits = 2,
      caption = "Pairwise Tukey's test statistics by LIO for PBDEs.")


kable(tidy((TukeyHSD(aC, conf.level=.95))), digits = 2,
      caption = "Pairwise Tukey's test statistics by LIO for PCBs.")

```

## Parameter summary tables

```{r param_summary_tables}

kable(tidy(PA_lm), digits = 2,
      caption = "Parameter estimates, associated standard errors, and t-statistics for the model of PAHs.")

kable(tidy(PB_lm), digits = 2,
      caption = "Parameter estimates, associated standard errors, and t-statistics for the model of PBDEs.")

kable(tidy(PC_lm), digits = 2,
      caption = "Parameter estimates, associated standard errors, and t-statistics for the model of PCBs.")

```


## Raincloud plots

Here are additional plots of the distribution of analytes across WRIA and time.

### PAH

```{r PAH appendix raincloud plots, message = FALSE, echo = FALSE}

#PAH LIO plots
plot_list = list()
for (i in c("1", "2", "3","6",
                                                         "18",
                                                         "17","15", 
                                                          "8", "9","14","16",
                                                          "13","12","10", "11")){
  wria_subset <- PA_df[PA_df$wria_nr==i,]
  p = wria_subset %>%
    ggplot(aes(x = year, y = dry_value)) +
      scale_y_continuous(trans='log10')+
    ggdist::stat_halfeye(adjust = .5, width = .3, .width = 0, justification = -.3, point_colour = NA) + 
    geom_boxplot(width = .1, outlier.shape = NA) + coord_flip()+
    ggdist::stat_dots(side = "left", dotsize = .05, justification = 1.1, binwidth = .1) +
    ggtitle(paste("PAHs - WRIA #",i)) +
    # theme(axis.text.x=element_text(angle=270,hjust=1)) +
    xlab("Year") +
    ylab("log10(dry value)")
  plot_list[[i]] = p
}
# I cannot get this to mute the list?
print(plot_list)

```

\newpage

### PBDE

```{r PBDE appendix raincloud plots, message = FALSE, echo = FALSE}

# PBDE WRIA plots
plot_list = list()
for (i in c("1", "2", "3","6",
                                                         "18",
                                                         "17","15", 
                                                          "8", "9","14","16",
                                                          "13","12","10", "11")){
  wria_subset <- PB_df[PB_df$wria_nr==i,]
  p = wria_subset %>%
    ggplot(aes(x = year, y = dry_value)) +
      scale_y_continuous(trans='log10')+
    ggdist::stat_halfeye(adjust = .5, width = .3, .width = 0, justification = -.3, point_colour = NA) + 
    geom_boxplot(width = .1, outlier.shape = NA) + coord_flip()+
    ggdist::stat_dots(side = "left", dotsize = .05, justification = 1.1, binwidth = .1) +
    ggtitle(paste("PBDEs - WRIA #",i)) +
    # theme(axis.text.x=element_text(angle=270,hjust=1)) +
    xlab("Year") +
    ylab("log10(dry value)")
  plot_list[[i]] = p
}

# I cannot get this to mute the list?
print(plot_list)

```

\newpage

### PCB

```{r PCB appendix raincloud plots, message = FALSE, echo = FALSE}

# PCB WRIA plots
plot_list = list()
for (i in c("1", "2", "3","6",
                                                         "18",
                                                         "17","15", 
                                                          "8", "9","14","16",
                                                          "13","12","10", "11")){
  wria_subset <- PC_df[PC_df$wria_nr==i,]
  p = wria_subset %>%
    ggplot(aes(x = year, y = dry_value)) +
      scale_y_continuous(trans='log10')+
    ggdist::stat_halfeye(adjust = .5, width = .3, .width = 0, justification = -.3, point_colour = NA) + 
    geom_boxplot(width = .1, outlier.shape = NA) + coord_flip()+
    ggdist::stat_dots(side = "left", dotsize = .05, justification = 1.1, binwidth = .1) +
    ggtitle(paste("PCBs - WRIA #",i)) +
    # theme(axis.text.x=element_text(angle=270,hjust=1)) +
    xlab("Year") +
    ylab("log10(dry value)")
  plot_list[[i]] = p
}
# I cannot get this to mute the list?
print(plot_list)

```

